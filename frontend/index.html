<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real Estate Agent</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }
      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }
      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      .tab-btn {
        padding: 12px 24px;
        background: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
      }
      .tab-btn.active {
        background: #667eea;
        color: white;
      }
      .tab-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .tab-content {
        display: none;
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      .tab-content.active {
        display: block;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }
      input,
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }
      input:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }
      button {
        background: #667eea;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
      }
      button:hover {
        background: #764ba2;
        transform: translateY(-2px);
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      .response {
        margin-top: 20px;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }
      .response h3 {
        color: #667eea;
        margin-bottom: 10px;
      }
      .response p {
        color: #333;
        line-height: 1.6;
      }
      .loading {
        display: none;
        text-align: center;
        color: #667eea;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .session-info {
        background: #f0f0f0;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .error {
        color: #e74c3c;
        padding: 10px;
        background: #fadbd8;
        border-radius: 8px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üè† Real Estate Agent</h1>
        <p>Find your perfect property, write emails, and explore locations</p>
      </div>

      <div class="session-info">
        <label>Session ID:</label>
        <input
          type="text"
          id="sessionId"
          placeholder="Enter your session ID (e.g., user123)"
          value="default"
        />
      </div>

      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('query')">
          Property Search
        </button>
        <button class="tab-btn" onclick="switchTab('location')">
          Location Estimation
        </button>
        <button class="tab-btn" onclick="switchTab('email')">
          Email Writer
        </button>
      </div>

      <!-- Property Search Tab -->
      <div id="query" class="tab-content active">
        <h2>Search for Properties</h2>
        <form onsubmit="handleQuery(event)">
          <div class="form-group">
            <label for="queryInput">Enter your search query:</label>
            <textarea
              id="queryInput"
              placeholder="e.g., Find me a room in London under ¬£800 per month, furnished"
              rows="4"
            ></textarea>
          </div>
          <button type="submit">Search Properties</button>
        </form>
        <div id="queryLoading" class="loading">
          <div class="spinner"></div>
          <p>Searching for properties...</p>
        </div>
        <div id="queryResponse"></div>
      </div>

      <!-- Location Estimation Tab -->
      <div id="location" class="tab-content">
        <h2>Location Estimation</h2>
        <form onsubmit="handleLocation(event)">
          <div class="form-group">
            <label for="locationInput">Enter location name:</label>
            <input
              type="text"
              id="locationInput"
              placeholder="e.g., London, Manchester, RG2"
              required
            />
          </div>
          <button type="submit">Get Location Info</button>
        </form>
        <div id="locationLoading" class="loading">
          <div class="spinner"></div>
          <p>Fetching location information...</p>
        </div>
        <div id="locationResponse"></div>
      </div>

      <!-- Email Writer Tab -->
      <div id="email" class="tab-content">
        <h2>Email Writer</h2>
        <form onsubmit="handleEmail(event)">
          <div class="form-group">
            <label for="emailInput">Describe your email request:</label>
            <textarea
              id="emailInput"
              placeholder="e.g., Write an email to a landlord inquiring about a flat in London with 2 bedrooms"
              rows="4"
            ></textarea>
          </div>
          <button type="submit">Generate Email</button>
        </form>
        <div id="emailLoading" class="loading">
          <div class="spinner"></div>
          <p>Generating email...</p>
        </div>
        <div id="emailResponse"></div>
      </div>
    </div>

    <script>
      function switchTab(tabName) {
        document
          .querySelectorAll(".tab-content")
          .forEach((tab) => tab.classList.remove("active"));
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document.getElementById(tabName).classList.add("active");
        event.target.classList.add("active");
      }

      function getSessionId() {
        return document.getElementById("sessionId").value || "default";
      }

      async function sendRequest(prompt) {
        const sessionId = getSessionId();
        const payload = {
          query: { prompt },
          session_input: { session_id: sessionId },
        };

        try {
          const response = await fetch(
            "http://127.0.0.1:8000/realestate-agent",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(payload),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          return await response.json();
        } catch (error) {
          throw new Error(`API Error: ${error.message}`);
        }
      }

      async function handleQuery(event) {
        event.preventDefault(); // <-- IMPORTANT: Prevent page refresh
        const prompt = document.getElementById("queryInput").value;
        if (!prompt.trim()) {
          alert("Please enter a search query");
          return;
        }

        const loading = document.getElementById("queryLoading");
        const responseDiv = document.getElementById("queryResponse");
        loading.style.display = "block";
        responseDiv.innerHTML = "";

        try {
          const data = await sendRequest(prompt);
          responseDiv.innerHTML = `
                    <div class="response">
                        <h3>Agent: ${data.agent}</h3>
                        <p>${data.result || "No results found"}</p>
                    </div>
                `;
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        } finally {
          loading.style.display = "none";
        }
      }

      async function handleLocation(event) {
        event.preventDefault(); // <-- IMPORTANT: Prevent page refresh
        const location = document.getElementById("locationInput").value;
        if (!location.trim()) {
          alert("Please enter a location");
          return;
        }

        const prompt = `What are the details and coordinates for ${location}?`;
        const loading = document.getElementById("locationLoading");
        const responseDiv = document.getElementById("locationResponse");
        loading.style.display = "block";
        responseDiv.innerHTML = "";

        try {
          const data = await sendRequest(prompt);
          responseDiv.innerHTML = `
                    <div class="response">
                        <h3>Location Information</h3>
                        <p>${data.result || "No information found"}</p>
                    </div>
                `;
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        } finally {
          loading.style.display = "none";
        }
      }

      async function handleEmail(event) {
        event.preventDefault(); // <-- IMPORTANT: Prevent page refresh
        const emailRequest = document.getElementById("emailInput").value;
        if (!emailRequest.trim()) {
          alert("Please describe your email request");
          return;
        }

        const loading = document.getElementById("emailLoading");
        const responseDiv = document.getElementById("emailResponse");
        loading.style.display = "block";
        responseDiv.innerHTML = "";

        try {
          const data = await sendRequest(emailRequest);
          responseDiv.innerHTML = `
                    <div class="response">
                        <h3>Generated Email</h3>
                        <pre style="background: white; padding: 15px; border-radius: 8px; overflow-x: auto;">${
                          data.result || "No email generated"
                        }</pre>
                    </div>
                `;
        } catch (error) {
          responseDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        } finally {
          loading.style.display = "none";
        }
      }
    </script>
  </body>
</html>
